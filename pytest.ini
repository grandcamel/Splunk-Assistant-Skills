[pytest]
# Test discovery paths
testpaths = skills tests

# Directories to ignore during test collection
# Note: live_integration tests require additional dependencies (testcontainers)
# Run them explicitly with: pytest skills/*/tests/live_integration/ -v
norecursedirs =
    .claude
    __pycache__
    .git
    .venv
    node_modules
    templates
    docker
    live_integration

# Test file patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Import mode - use importlib to avoid conflicts with multiple tests/ directories
# Add shared live_integration to pythonpath for fixture discovery
pythonpath = . skills/shared/tests/live_integration
addopts = -v --tb=short --import-mode=importlib

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# Markers (30+ for comprehensive test categorization)
markers =
    # Speed markers
    slow: marks tests as slow (>30s)
    fast: marks tests as fast (<1s)
    slow_integration: marks slow integration tests

    # Environment markers
    live: marks tests requiring live API access
    integration: marks tests as integration tests
    unit: marks unit tests (no external dependencies)
    docker_required: marks tests that require Docker
    external_splunk: marks tests for external Splunk only
    cloud_only: marks tests for Splunk Cloud only
    onprem_only: marks tests for on-premises Splunk only

    # Risk/modification markers
    destructive: marks tests that modify Splunk data
    readonly: marks tests that only read data
    creates_data: marks tests that create new resources
    deletes_data: marks tests that delete resources
    modifies_config: marks tests that change configuration

    # Feature area markers
    search: marks tests for search operations
    job: marks tests for job lifecycle
    metadata: marks tests for metadata discovery
    export: marks tests for data export
    lookup: marks tests for lookup management
    savedsearch: marks tests for saved search CRUD
    alert: marks tests for alert management
    security: marks tests for token/RBAC/ACL
    kvstore: marks tests for KV store operations
    app: marks tests for app management
    admin: marks tests for admin/REST operations
    metrics: marks tests for metrics (mstats/mcatalog)
    tag: marks tests for tag operations

    # Authentication markers
    bearer_auth: marks tests using bearer token auth
    basic_auth: marks tests using basic auth
    requires_admin: marks tests requiring admin privileges
    requires_power: marks tests requiring power user role

    # Resource markers
    requires_index: marks tests requiring specific index
    requires_lookup: marks tests requiring lookup file
    requires_kvstore: marks tests requiring KV store
    requires_savedsearch: marks tests requiring saved search

    # Stability markers
    flaky: marks tests that may be flaky/unstable
    smoke: marks smoke tests for quick validation
    regression: marks regression tests
    xfail_known: marks expected failures with known issues

    # Parallel execution markers
    serial: marks tests that must run serially
    parallel_safe: marks tests safe for parallel execution
