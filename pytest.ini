[pytest]
# Test discovery paths
testpaths = skills tests

# Directories to ignore during test collection
norecursedirs =
    .claude
    __pycache__
    .git
    .venv
    node_modules
    templates
    docker

# Test file patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Import mode - use importlib to avoid conflicts with multiple tests/ directories
pythonpath = .
addopts = -v --tb=short --import-mode=importlib

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# Markers for test categorization
markers =
    # Speed markers
    slow: marks tests as slow (>30s)
    fast: marks tests as fast (<1s)

    # Environment markers
    integration: marks tests as integration tests
    unit: marks unit tests (no external dependencies)
    cloud_only: marks tests for Splunk Cloud only
    onprem_only: marks tests for on-premises Splunk only

    # Feature area markers
    search: marks tests for search operations
    job: marks tests for job lifecycle
    metadata: marks tests for metadata discovery
    export: marks tests for data export
    lookup: marks tests for lookup management
    savedsearch: marks tests for saved search CRUD
    alert: marks tests for alert management
    security: marks tests for token/RBAC/ACL
    kvstore: marks tests for KV store operations
    app: marks tests for app management
    admin: marks tests for admin/REST operations
    metrics: marks tests for metrics (mstats/mcatalog)
    tag: marks tests for tag operations

    # Authentication markers
    bearer_auth: marks tests using bearer token auth
    basic_auth: marks tests using basic auth
    requires_admin: marks tests requiring admin privileges
    requires_power: marks tests requiring power user role

    # Stability markers
    flaky: marks tests that may be flaky/unstable
    smoke: marks smoke tests for quick validation
    regression: marks regression tests
    xfail_known: marks expected failures with known issues

    # Parallel execution markers
    serial: marks tests that must run serially
    parallel_safe: marks tests safe for parallel execution
